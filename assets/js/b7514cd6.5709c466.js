/*! For license information please see b7514cd6.5709c466.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[505616],{571430:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var o=n(785893),r=n(511151);const a={id:"react-router-stable-migration",title:"React Router 6.0 Migration",description:"Guide for how to migrate from React Router v6 beta to React Router v6 stable"},i=void 0,s={id:"tutorials/react-router-stable-migration",title:"React Router 6.0 Migration",description:"Guide for how to migrate from React Router v6 beta to React Router v6 stable",source:"@site/../docs/tutorials/react-router-stable-migration.md",sourceDirName:"tutorials",slug:"/tutorials/react-router-stable-migration",permalink:"/docs/tutorials/react-router-stable-migration",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/tutorials/react-router-stable-migration.md",tags:[],version:"current",frontMatter:{id:"react-router-stable-migration",title:"React Router 6.0 Migration",description:"Guide for how to migrate from React Router v6 beta to React Router v6 stable"},sidebar:"docs",previous:{title:"Adding Custom Plugin to Existing Monorepo App",permalink:"/docs/tutorials/quickstart-app-plugin"},next:{title:"Migrating to React 18",permalink:"/docs/tutorials/react18-migration"}},c={},d=[{value:"Migration",id:"migration",level:2},{value:"Step 1 - Upgrade to Backstage 1.6",id:"step-1---upgrade-to-backstage-16",level:3},{value:"Step 2 - Move <code>react-router</code> to <code>peerDependencies</code>",id:"step-2---move-react-router-to-peerdependencies",level:3},{value:"Step 3 - Ensure that your external plugins are updated",id:"step-3---ensure-that-your-external-plugins-are-updated",level:3},{value:"Step 4 - Bump the React Router dependencies in your app",id:"step-4---bump-the-react-router-dependencies-in-your-app",level:3},{value:"Step 5 - Breaking Changes",id:"step-5---breaking-changes",level:3},{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"Route paths",id:"route-paths",level:3},{value:"Routes and Route components",id:"routes-and-route-components",level:3},{value:"<code>PermissionedRoute</code>",id:"permissionedroute",level:3},{value:"<code>&lt;Navigate /&gt;</code> component",id:"navigate--component",level:3},{value:"<code>NavLink</code>",id:"navlink",level:3},{value:"For Plugin Authors",id:"for-plugin-authors",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Backstage has for a long time been using ",(0,o.jsx)(t.code,{children:"react-router"})," version ",(0,o.jsx)(t.code,{children:"6.0.0-beta.0"}),".\nWe adopted this unstable version because v6 had some new features that fit\nreally well with Backstage, particularly relative routing. Because we jumped on\nthis early and unstable version, we knew that we would at some point need a\nbreaking migration to the stable version of ",(0,o.jsx)(t.code,{children:"react-router"})," v6, which is the\npoint we're at now!"]}),"\n",(0,o.jsxs)(t.p,{children:["This migration is required but controlled by each app, meaning that you choose\nwhen you want to migrate your app. There will however be some point in the\nfuture where we drop support for the beta version of ",(0,o.jsx)(t.code,{children:"react-router"}),", at which\ntime you would be forced to migrate."]}),"\n",(0,o.jsxs)(t.p,{children:["The stable version of React Router v6 brings a number of improvements and bug\nfixes. Notably, the way that paths are resolved has been improved, which fixes a\nbug where paths like ",(0,o.jsx)(t.code,{children:"/catalog"})," and ",(0,o.jsx)(t.code,{children:"/catalog-import"})," could get confused."]}),"\n",(0,o.jsx)(t.h2,{id:"migration",children:"Migration"}),"\n",(0,o.jsx)(t.h3,{id:"step-1---upgrade-to-backstage-16",children:"Step 1 - Upgrade to Backstage 1.6"}),"\n",(0,o.jsxs)(t.p,{children:["The first Backstage release to support ",(0,o.jsx)(t.code,{children:"react-router"})," v6 is ",(0,o.jsx)(t.code,{children:"1.6"}),". You should upgrade to this version first before you start migrating. If you are an early bird and want to try out migration before that release, it is also shipped in ",(0,o.jsx)(t.code,{children:"1.6.0-next.1"}),"."]}),"\n",(0,o.jsxs)(t.h3,{id:"step-2---move-react-router-to-peerdependencies",children:["Step 2 - Move ",(0,o.jsx)(t.code,{children:"react-router"})," to ",(0,o.jsx)(t.code,{children:"peerDependencies"})]}),"\n",(0,o.jsxs)(t.p,{children:["It's important that only one version of ",(0,o.jsx)(t.code,{children:"react-router"})," is installed in the\nproject at a time. Similar to how the ",(0,o.jsx)(t.code,{children:"react"})," version is handled, all plugins\nand packages now declare a peer dependency on the React Router dependencies,\nrather than a direct dependency. The only exception to this is the app package\n(in ",(0,o.jsx)(t.code,{children:"packages/app/package.json"}),"), which has the direct dependencies that end up\ndeciding what version of React Router that you are using in your project."]}),"\n",(0,o.jsxs)(t.p,{children:["Your internal packages might specify a dependency on ",(0,o.jsx)(t.code,{children:"react-router"})," or ",(0,o.jsx)(t.code,{children:"react-router-dom"})," in their ",(0,o.jsx)(t.code,{children:"package.json"}),", and it's important that those are converted to ",(0,o.jsx)(t.code,{children:"peerDependencies"})," so that we can control the version of ",(0,o.jsx)(t.code,{children:"react-router"})," in the app ",(0,o.jsx)(t.code,{children:"package.json"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"You can automate this step by running the following command:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"yarn backstage-cli migrate react-router-deps\n"})}),"\n",(0,o.jsxs)(t.p,{children:["For those interested in doing this manually, apply the below change to all ",(0,o.jsx)(t.code,{children:"package.json"})," files except the one at ",(0,o.jsx)(t.code,{children:"packages/app/package.json"})," or any other app packages. Skip moving any dependencies that don't already exist, and move both ",(0,o.jsx)(t.code,{children:"dependencies"})," and ",(0,o.jsx)(t.code,{children:"devDependencies"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-diff",metastring:'title="package.json"',children:' dependencies {\n   ...\n-  "react-router-dom": "^6.0.0-beta.0",\n-  "react-router": "^6.0.0-beta.0"\n },\n peerDependencies: {\n   ...\n+  "react-router-dom": "6.0.0-beta.0 || ^6.3.0",\n+  "react-router": "6.0.0-beta.0 || ^6.3.0"\n },\n'})}),"\n",(0,o.jsx)(t.h3,{id:"step-3---ensure-that-your-external-plugins-are-updated",children:"Step 3 - Ensure that your external plugins are updated"}),"\n",(0,o.jsxs)(t.p,{children:["It's important that you also update your external plugins to their latest version as these will have to perform the same ",(0,o.jsx)(t.code,{children:"peerDependencies"})," update."]}),"\n",(0,o.jsxs)(t.p,{children:["During this migration there may be external plugins that need updating. If you encounter any plugins outside of the ",(0,o.jsx)(t.code,{children:"@backstage"})," scope that are incompatible with your installation, make sure to check for an existing issue or raise a new one at the plugin's GitHub repository."]}),"\n",(0,o.jsx)(t.h3,{id:"step-4---bump-the-react-router-dependencies-in-your-app",children:"Step 4 - Bump the React Router dependencies in your app"}),"\n",(0,o.jsxs)(t.p,{children:["Now it's time to do the actual migration to the latest version of React Router. At this time of writing that is ",(0,o.jsx)(t.code,{children:"6.3.0"}),", but that is of course a moving target."]}),"\n",(0,o.jsxs)(t.p,{children:["The first step is to modify ",(0,o.jsx)(t.code,{children:"packages/app/package.json"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-diff",metastring:'title="package.json"',children:'-    "react-router": "6.0.0-beta.0",\n-    "react-router-dom": "6.0.0-beta.0",\n+    "react-router": "^6.3.0",\n+    "react-router-dom": "^6.3.0",\n'})}),"\n",(0,o.jsx)(t.p,{children:"In case you happen to have multiple app packages in your project, apply the same change to all those packages."}),"\n",(0,o.jsxs)(t.p,{children:["Once the change has been made, run ",(0,o.jsx)(t.code,{children:"yarn install"}),", and then ",(0,o.jsx)(t.code,{children:"yarn why react-router"})," to validate the installation. You should see the following line in the log as the only resulting entry:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'=> Found "react-router@6.3.0"\n'})}),"\n",(0,o.jsxs)(t.p,{children:["If you see multiple entries, and especially ",(0,o.jsx)(t.code,{children:'=> Found "react-router@6.0.0-beta.0"'}),", then your dependencies have not yet been fully migrated to support React Router v6 stable. Double check the steps above, using the information that the Yarn ",(0,o.jsx)(t.code,{children:"why"})," command logged. Repeat the same process for ",(0,o.jsx)(t.code,{children:"yarn why react-router-dom"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["If you end up being stuck not being able to move your entire project to stable versions cleanly, then you can use Yarn ",(0,o.jsx)(t.code,{children:'"resolutions"'})," overrides in your root ",(0,o.jsx)(t.code,{children:"package.json"}),". Try to avoid this option as it may lead to hidden breakages at runtime, and verify any plugins that needed the override. A better option is likely to hold off migrating for a while until plugins have had time to be updated."]}),"\n",(0,o.jsx)(t.h3,{id:"step-5---breaking-changes",children:"Step 5 - Breaking Changes"}),"\n",(0,o.jsxs)(t.p,{children:["For a new app created with ",(0,o.jsx)(t.code,{children:"npx @backstage/create-app"}),", the above steps are all you need to do. If you have created internal plugins and customizations then be sure to review the breaking changes in the ",(0,o.jsx)(t.a,{href:"https://reactrouter.com/docs/en/v6/upgrading/reach#breaking-updates",children:"React Router changelog"})," and validate all parts of your app. We've summarized the most important breaking changes below."]}),"\n",(0,o.jsx)(t.h2,{id:"breaking-changes",children:"Breaking Changes"}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"https://reactrouter.com/docs/en/v6/upgrading/reach#breaking-updates",children:"changelog"})," for a full list of breaking changes. Below we highlight a couple of the most important ones."]}),"\n",(0,o.jsx)(t.h3,{id:"route-paths",children:"Route paths"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"Route"})," components must always contain a ",(0,o.jsx)(t.code,{children:"path"})," or ",(0,o.jsx)(t.code,{children:"index"})," prop."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'<Routes>\n  {/* Invalid */}\n  <Route element={<Example />} />\n\n  {/* Valid */}\n  <Route path="/" element={<Example />} />\n\n  {/* Valid but discouraged due to incompatibility with react-router beta */}\n  <Route index element={<Example />} />\n</Routes>\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Absolute route paths within each ",(0,o.jsx)(t.code,{children:"Routes"})," element must now match their own location, meaning that the following is invalid:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'<Routes>\n  <Route path="/foo">\n    <Route path="/bar" /> {/* INVALID, must be "/foo/bar" or "bar" */}\n  </Route>\n</Routes>\n'})}),"\n",(0,o.jsx)(t.h3,{id:"routes-and-route-components",children:"Routes and Route components"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"Routes"})," and ",(0,o.jsx)(t.code,{children:"Route"})," component both received a large related breaking changes. It is no longer possible\nto have anything but ",(0,o.jsx)(t.code,{children:"Route"})," elements and React fragments be a child of a ",(0,o.jsx)(t.code,{children:"Routes"})," element. This means that\nstructures like these:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'<Routes>\n  <MyComponent path="/foo" />\n  ...\n</Routes>\n'})}),"\n",(0,o.jsx)(t.p,{children:"need to be migrated to this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'<Routes>\n  <Route path="/foo" element={<MyComponent />} />\n  ...\n</Routes>\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Somewhat related to the ",(0,o.jsx)(t.code,{children:"Routes"})," change, it is no longer possible to render a\n",(0,o.jsx)(t.code,{children:"Route"})," element by itself, outside of a ",(0,o.jsx)(t.code,{children:"Routes"})," wrapper. Previously, rendering\nsuch a ",(0,o.jsx)(t.code,{children:"Route"})," element would cause the contents of its ",(0,o.jsx)(t.code,{children:"element"})," prop to be\nrendered instead, but it will now throw an error."]}),"\n",(0,o.jsx)(t.h3,{id:"permissionedroute",children:(0,o.jsx)(t.code,{children:"PermissionedRoute"})}),"\n",(0,o.jsxs)(t.p,{children:["Because of the above change, the ",(0,o.jsx)(t.code,{children:"PermissionedRoute"})," component no longer works in all situations with React Router v6 stable. It has been deprecated in favor of the new ",(0,o.jsx)(t.code,{children:"RequirePermission"})," component, which can be placed anywhere in order to perform a permissions check."]}),"\n",(0,o.jsxs)(t.p,{children:["It's crucial that you update to ",(0,o.jsx)(t.code,{children:"RequirePermission"})," at the same time as you update to React Router v6 stable as the ",(0,o.jsx)(t.code,{children:"PermissionedRoute"})," component will no longer function."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'{/* highlight-remove-start */}\n<PermissionedRoute\n  path="/catalog-import"\n  permission={catalogEntityCreatePermission}\n  element={<CatalogImportPage />}\n{/* highlight-remove-end */}\n{/* highlight-add-start */}\n<Route\n  path="/catalog-import"\n  element={\n    <RequirePermission permission={catalogEntityCreatePermission}>\n      <CatalogImportPage />\n    </RequirePermission>\n  }\n{/* highlight-add-end */}\n/>\n'})}),"\n",(0,o.jsxs)(t.h3,{id:"navigate--component",children:[(0,o.jsx)(t.code,{children:"<Navigate />"})," component"]}),"\n",(0,o.jsxs)(t.p,{children:["When migrating over to React Router v6 stable, you might also see browser console warnings for the ",(0,o.jsx)(t.code,{children:"Navigate"})," component. This will need to be wrapped up in a ",(0,o.jsx)(t.code,{children:"Route"})," component with the ",(0,o.jsx)(t.code,{children:"Navigate"})," component in the ",(0,o.jsx)(t.code,{children:"element"})," prop."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:'{\n  /* highlight-remove-next-line */\n}\n<Navigate key="/" to="catalog" />;\n{\n  /* highlight-add-next-line */\n}\n<Route path="/" element={<Navigate to="catalog" />} />;\n'})}),"\n",(0,o.jsx)(t.h3,{id:"navlink",children:(0,o.jsx)(t.code,{children:"NavLink"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"NavLink"})," component no longer has the ",(0,o.jsx)(t.code,{children:"activeClassName"})," and ",(0,o.jsx)(t.code,{children:"activeStyle"})," props. Instead, the ",(0,o.jsx)(t.code,{children:"className"})," and ",(0,o.jsx)(t.code,{children:"style"})," props accept a callback that receives a boolean indicating whether the link is active."]}),"\n",(0,o.jsx)(t.h2,{id:"for-plugin-authors",children:"For Plugin Authors"}),"\n",(0,o.jsxs)(t.p,{children:["There are a few things to keep in mind when migrating a published plugin. You of course need to make sure that dependencies on React Router are moved to ",(0,o.jsx)(t.code,{children:"peerDependencies"})," as described above.\nIn addition, you need to make sure that your plugin truly is compatible with both versions of React Router at runtime. To help you achieve that, you can follow these additional guidelines:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Bump the version of ",(0,o.jsx)(t.code,{children:"react-router"})," and ",(0,o.jsx)(t.code,{children:"react-router-dom"})," in your own project to use the stable version. Place them in ",(0,o.jsx)(t.code,{children:"devDependencies"})," if your plugin is a single package project. The stable version is more strict, so this is the better baseline to work from."]}),"\n",(0,o.jsxs)(t.li,{children:["Make sure all ",(0,o.jsx)(t.code,{children:"Route"})," elements have a ",(0,o.jsx)(t.code,{children:"path"})," prop. Do not use the new ",(0,o.jsx)(t.code,{children:"index"})," props, as it is not supported by the beta version. Use ",(0,o.jsx)(t.code,{children:'path="/"'})," for the index routes within a ",(0,o.jsx)(t.code,{children:"Routes"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["If you are using ",(0,o.jsx)(t.code,{children:"NavLink"}),", use both the new and old APIs simultaneously, and work around any TypeScript errors."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(t.p,{children:"Check the browser console for React Router related error messages."}),"\n",(0,o.jsxs)(t.p,{children:["Check ",(0,o.jsx)(t.code,{children:"yarn.lock"})," for packages depending on older versions of ",(0,o.jsx)(t.code,{children:"react-router"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"yarn why react-router\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},675251:(e,t,n)=>{var o=n(667294),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var o,a={},d=null,l=null;for(o in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)i.call(t,o)&&!c.hasOwnProperty(o)&&(a[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===a[o]&&(a[o]=t[o]);return{$$typeof:r,type:e,key:d,ref:l,props:a,_owner:s.current}}t.Fragment=a,t.jsx=d,t.jsxs=d},785893:(e,t,n)=>{e.exports=n(675251)},511151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>i});var o=n(667294);const r={},a=o.createContext(r);function i(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);