/*! For license information please see 6229684a.46dc28fc.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[529526],{751534:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});var o=t(785893),s=t(511151);const c={id:"getting-started",title:"Getting Started",description:"Getting Started Documentation"},a=void 0,r={id:"features/techdocs/getting-started",title:"Getting Started",description:"Getting Started Documentation",source:"@site/../docs/features/techdocs/getting-started.md",sourceDirName:"features/techdocs",slug:"/features/techdocs/getting-started",permalink:"/docs/features/techdocs/getting-started",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/../docs/features/techdocs/getting-started.md",tags:[],version:"current",frontMatter:{id:"getting-started",title:"Getting Started",description:"Getting Started Documentation"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/features/techdocs/"},next:{title:"Concepts",permalink:"/docs/features/techdocs/concepts"}},i={},d=[{value:"Adding TechDocs frontend plugin",id:"adding-techdocs-frontend-plugin",level:2},{value:"Adding TechDocs Backend plugin",id:"adding-techdocs-backend-plugin",level:2},{value:"New Backend System",id:"new-backend-system",level:3},{value:"Setting the configuration",id:"setting-the-configuration",level:2},{value:"Should TechDocs Backend generate docs?",id:"should-techdocs-backend-generate-docs",level:3},{value:"Choosing storage (publisher)",id:"choosing-storage-publisher",level:3},{value:"Disabling Docker in Docker situation (Optional)",id:"disabling-docker-in-docker-situation-optional",level:3},{value:"Additional reading",id:"additional-reading",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"TechDocs functions as a plugin to Backstage, so you will need to use Backstage\nto use TechDocs."}),"\n",(0,o.jsxs)(n.p,{children:["If you haven't setup Backstage already, start\n",(0,o.jsx)(n.a,{href:"/docs/getting-started/",children:"here"}),"."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If you used ",(0,o.jsx)(n.code,{children:"npx @backstage/create-app"}),", TechDocs may already be present."]}),"\n",(0,o.jsxs)(n.p,{children:["You should skip to ",(0,o.jsx)(n.a,{href:"#setting-the-configuration",children:(0,o.jsx)(n.code,{children:"Setting the Configuration"})}),"\nbelow."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"adding-techdocs-frontend-plugin",children:"Adding TechDocs frontend plugin"}),"\n",(0,o.jsxs)(n.p,{children:["The first step is to add the TechDocs plugin to your Backstage application.\nNavigate to your new Backstage application directory. And then to your\n",(0,o.jsx)(n.code,{children:"packages/app"})," directory, and install the ",(0,o.jsx)(n.code,{children:"@backstage/plugin-techdocs"})," package."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",metastring:'title="From your Backstage root directory"',children:"yarn --cwd packages/app add @backstage/plugin-techdocs\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once the package has been installed, you need to import the plugin in your app."}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"packages/app/src/App.tsx"}),", import ",(0,o.jsx)(n.code,{children:"TechDocsPage"})," and add the following to\n",(0,o.jsx)(n.code,{children:"FlatRoutes"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",metastring:'title="packages/app/src/App.tsx"',children:'import {\n  DefaultTechDocsHome,\n  TechDocsIndexPage,\n  TechDocsReaderPage,\n} from \'@backstage/plugin-techdocs\';\n\nconst AppRoutes = () => {\n  <FlatRoutes>\n    {/* ... other plugin routes */}\n    <Route path="/docs" element={<TechDocsIndexPage />}>\n      <DefaultTechDocsHome />\n    </Route>\n    <Route\n      path="/docs/:namespace/:kind/:name/*"\n      element={<TechDocsReaderPage />}\n    />\n  </FlatRoutes>;\n};\n'})}),"\n",(0,o.jsx)(n.p,{children:"It would be nice to decorate your pages with something else... Having a link that redirects you to a new issue page when you highlight text in your documentation would be really cool, right? Let's learn how to do this using the TechDocs Addon Framework!"}),"\n",(0,o.jsxs)(n.p,{children:["With the ",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/features/techdocs/addons#installing-and-using-addons",children:"TechDocs Addon framework"}),", you can render React components in documentation pages and these Addons can be provided by any Backstage plugin. The framework is exported by the ",(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/@backstage/plugin-techdocs-react",children:"@backstage/plugin-techdocs-react"})," package and there is a ",(0,o.jsx)(n.code,{children:"<ReportIssue />"})," Addon in the ",(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/@backstage/plugin-techdocs-module-addons-contrib",children:"@backstage/plugin-techdocs-module-addons-contrib"})," package for you to use once you have these two dependencies installed:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"import {\n  DefaultTechDocsHome,\n  TechDocsIndexPage,\n  TechDocsReaderPage,\n} from '@backstage/plugin-techdocs';\n/* highlight-add-start */\nimport { TechDocsAddons } from '@backstage/plugin-techdocs-react';\nimport { ReportIssue } from '@backstage/plugin-techdocs-module-addons-contrib';\n/* highlight-add-end */\n\nconst AppRoutes = () => {\n  <FlatRoutes>\n    {/* ... other plugin routes */}\n    <Route path=\"/docs\" element={<TechDocsIndexPage />}>\n      <DefaultTechDocsHome />\n    </Route>\n    <Route\n      path=\"/docs/:namespace/:kind/:name/*\"\n      element={<TechDocsReaderPage />}\n    >\n      {/* highlight-add-start */}\n      <TechDocsAddons>\n        <ReportIssue />\n      </TechDocsAddons>\n      {/* highlight-add-end */}\n    </Route>\n  </FlatRoutes>;\n};\n"})}),"\n",(0,o.jsx)(n.p,{children:"I know, you're curious to see how it looks, aren't you? See the image below:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"TechDocs Report Issue Add-on",src:t(155385).Z+"",width:"666",height:"115"})}),"\n",(0,o.jsx)(n.p,{children:"By clicking the open new issue button, you will be redirected to the new issue page according to the source code provider you are using:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"TechDocs Report Issue Template",src:t(124973).Z+"",width:"738",height:"514"})}),"\n",(0,o.jsx)(n.p,{children:"That's it! Now, we need the TechDocs Backend plugin for the frontend to work."}),"\n",(0,o.jsx)(n.h2,{id:"adding-techdocs-backend-plugin",children:"Adding TechDocs Backend plugin"}),"\n",(0,o.jsxs)(n.p,{children:["Navigate to ",(0,o.jsx)(n.code,{children:"packages/backend"})," of your Backstage app, and install the\n",(0,o.jsx)(n.code,{children:"@backstage/plugin-techdocs-backend"})," package."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",metastring:'title="From your Backstage root directory"',children:"yarn --cwd packages/backend add @backstage/plugin-techdocs-backend\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Create a file called ",(0,o.jsx)(n.code,{children:"techdocs.ts"})," inside ",(0,o.jsx)(n.code,{children:"packages/backend/src/plugins/"})," and\nadd the following"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import { DockerContainerRunner } from '@backstage/backend-common';\nimport {\n  createRouter,\n  Generators,\n  Preparers,\n  Publisher,\n} from '@backstage/plugin-techdocs-backend';\nimport Docker from 'dockerode';\nimport { Router } from 'express';\nimport { PluginEnvironment } from '../types';\n\nexport default async function createPlugin(\n  env: PluginEnvironment,\n): Promise<Router> {\n  // Preparers are responsible for fetching source files for documentation.\n  const preparers = await Preparers.fromConfig(env.config, {\n    logger: env.logger,\n    reader: env.reader,\n  });\n\n  // Docker client (conditionally) used by the generators, based on techdocs.generators config.\n  const dockerClient = new Docker();\n  const containerRunner = new DockerContainerRunner({ dockerClient });\n\n  // Generators are used for generating documentation sites.\n  const generators = await Generators.fromConfig(env.config, {\n    logger: env.logger,\n  });\n\n  // Publisher is used for\n  // 1. Publishing generated files to storage\n  // 2. Fetching files from storage and passing them to TechDocs frontend.\n  const publisher = await Publisher.fromConfig(env.config, {\n    logger: env.logger,\n    discovery: env.discovery,\n  });\n\n  // checks if the publisher is working and logs the result\n  await publisher.getReadiness();\n\n  return await createRouter({\n    preparers,\n    generators,\n    publisher,\n    logger: env.logger,\n    config: env.config,\n    discovery: env.discovery,\n    cache: env.cache,\n  });\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You may need to install the ",(0,o.jsx)(n.code,{children:"dockerode"})," package. But you may already have it in\nyour backend since ",(0,o.jsx)(n.a,{href:"/docs/features/software-templates/",children:"Scaffolder plugin"})," also uses\nit."]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/concepts",children:"Concepts"})," and ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/architecture",children:"TechDocs Architecture"})," to\nlearn more about how preparers, generators and publishers work."]}),"\n",(0,o.jsxs)(n.p,{children:["The final step is to import the techdocs backend plugin in Backstage app\nbackend. Add the following to your ",(0,o.jsx)(n.code,{children:"packages/backend/src/index.ts"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-typescript",children:"import techdocs from './plugins/techdocs';\n\n// .... main should already be present.\nasync function main() {\n  // ... other backend plugin envs\n  const techdocsEnv = useHotMemoize(module, () => createEnv('techdocs'));\n\n  // ... other backend plugin routes\n  apiRouter.use('/techdocs', await techdocs(techdocsEnv));\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"That's it! TechDocs frontend and backend have now been added to your Backstage\napp. Now let us tweak some configurations to suit your needs."}),"\n",(0,o.jsx)(n.h3,{id:"new-backend-system",children:"New Backend System"}),"\n",(0,o.jsx)(n.p,{children:"To install TechDocs when using the New Backend system you will need to do the following."}),"\n",(0,o.jsxs)(n.p,{children:["Navigate to ",(0,o.jsx)(n.code,{children:"packages/backend"})," of your Backstage app, and install the ",(0,o.jsx)(n.code,{children:"@backstage/plugin-techdocs-backend"})," package."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",metastring:'title="From your Backstage root directory"',children:"yarn --cwd packages/backend add @backstage/plugin-techdocs-backend\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Then in your backend ",(0,o.jsx)(n.code,{children:"index.ts"})," you will add the following line."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="packages/backend/src/index.ts"',children:"const backend = createBackend();\n\n// Other plugins...\n\n/* highlight-add-start */\nbackend.add(import('@backstage/plugin-techdocs-backend/alpha'));\n/* highlight-add-end */\n\nbackend.start();\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"note",children:(0,o.jsx)(n.p,{children:"The above is a very simplified example, you may have more content then this in your version."})}),"\n",(0,o.jsx)(n.h2,{id:"setting-the-configuration",children:"Setting the configuration"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.strong,{children:["See ",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/configuration",children:"TechDocs Configuration Options"})," for complete\nconfiguration reference."]})}),"\n",(0,o.jsx)(n.h3,{id:"should-techdocs-backend-generate-docs",children:"Should TechDocs Backend generate docs?"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"techdocs:\n  builder: 'local'\n"})}),"\n",(0,o.jsxs)(n.p,{children:['Note that we recommend generating docs on CI/CD instead. Read more in the\n"Basic" and "Recommended" sections of the\n',(0,o.jsx)(n.a,{href:"/docs/features/techdocs/architecture",children:"TechDocs Architecture"}),". But if you want to get started quickly\nset ",(0,o.jsx)(n.code,{children:"techdocs.builder"})," to ",(0,o.jsx)(n.code,{children:"'local'"})," so that TechDocs Backend is responsible for\ngenerating documentation sites. If set to ",(0,o.jsx)(n.code,{children:"'external'"}),", Backstage will assume\nthat the sites are being generated on each entity's CI/CD pipeline, and are\nbeing stored in a storage somewhere."]}),"\n",(0,o.jsxs)(n.p,{children:["When ",(0,o.jsx)(n.code,{children:"techdocs.builder"})," is set to ",(0,o.jsx)(n.code,{children:"'external'"}),", TechDocs becomes more or less a\nread-only experience where it serves static files from a storage containing all\nthe generated documentation."]}),"\n",(0,o.jsx)(n.h3,{id:"choosing-storage-publisher",children:"Choosing storage (publisher)"}),"\n",(0,o.jsxs)(n.p,{children:["TechDocs needs to know where to store generated documentation sites and where to\nfetch the sites from. This is managed by a\n",(0,o.jsx)(n.a,{href:"/docs/features/techdocs/concepts#techdocs-publisher",children:"Publisher"}),". Examples: Google Cloud Storage,\nAmazon S3, or local filesystem of Backstage server."]}),"\n",(0,o.jsxs)(n.p,{children:['It is okay to use the local filesystem in a "basic" setup when you are trying\nout Backstage for the first time. At a later time, review\n',(0,o.jsx)(n.a,{href:"/docs/features/techdocs/using-cloud-storage",children:"Using Cloud Storage"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"techdocs:\n  builder: 'local'\n  publisher:\n    type: 'local'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"disabling-docker-in-docker-situation-optional",children:"Disabling Docker in Docker situation (Optional)"}),"\n",(0,o.jsxs)(n.p,{children:["You can skip this if your ",(0,o.jsx)(n.code,{children:"techdocs.builder"})," is set to ",(0,o.jsx)(n.code,{children:"'external'"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"The TechDocs Backend plugin runs a docker container with mkdocs installed to\ngenerate the frontend of the docs from source files (Markdown). If you are\ndeploying Backstage using Docker, this will mean that your Backstage Docker\ncontainer will try to run another Docker container for TechDocs Backend."}),"\n",(0,o.jsxs)(n.p,{children:["To avoid this problem, we have a configuration available. You can set a value in\nyour ",(0,o.jsx)(n.code,{children:"app-config.yaml"})," that tells the techdocs generator if it should run the\n",(0,o.jsx)(n.code,{children:"local"})," mkdocs or run it from ",(0,o.jsx)(n.code,{children:"docker"}),". This defaults to running as ",(0,o.jsx)(n.code,{children:"docker"})," if\nno config is provided."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"techdocs:\n  builder: 'local'\n  publisher:\n    type: 'local'\n  generator:\n    runIn: local\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Setting ",(0,o.jsx)(n.code,{children:"generator.runIn"})," to ",(0,o.jsx)(n.code,{children:"local"})," means you will have to make sure your\nenvironment is compatible with techdocs."]}),"\n",(0,o.jsxs)(n.p,{children:["You will have to install the ",(0,o.jsx)(n.code,{children:"mkdocs"})," and ",(0,o.jsx)(n.code,{children:"mkdocs-techdocs-core"})," package from\npip, optionally also ",(0,o.jsx)(n.code,{children:"graphviz"})," and ",(0,o.jsx)(n.code,{children:"plantuml"})," from your OS package manager (e.g.\napt)."]}),"\n",(0,o.jsxs)(n.p,{children:["You can do so by including the following lines right above ",(0,o.jsx)(n.code,{children:"USER node"})," of your\n",(0,o.jsx)(n.code,{children:"Dockerfile"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Dockerfile",children:'RUN apt-get update && apt-get install -y python3 python3-pip python3-venv\n\nENV VIRTUAL_ENV=/opt/venv\nRUN python3 -m venv $VIRTUAL_ENV\nENV PATH="$VIRTUAL_ENV/bin:$PATH"\n\nRUN pip3 install mkdocs-techdocs-core\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Please be aware that the version requirement could change, you need to check our\n",(0,o.jsx)(n.a,{href:"https://github.com/backstage/techdocs-container/blob/main/Dockerfile",children:(0,o.jsx)(n.code,{children:"Dockerfile"})}),"\nand make sure to match with it."]}),"\n",(0,o.jsxs)(n.p,{children:["On a Debian-based Docker container, Python packages must be either installed using\nthe OS package manager or within a virtual environment (see the\n",(0,o.jsx)(n.a,{href:"https://peps.python.org/pep-0668/",children:"related PEP"}),"). Alternative is to use e.g.\n",(0,o.jsx)(n.a,{href:"https://pypa.github.io/pipx/",children:"pipx"})," for installing Python packages in an isolated\nenvironment."]}),"\n",(0,o.jsxs)(n.p,{children:["The above Dockerfile snippet installs the latest ",(0,o.jsx)(n.code,{children:"mkdocs-techdoc-core"})," package.\nVersion numbers can be found in the corresponding\n",(0,o.jsx)(n.a,{href:"https://github.com/backstage/mkdocs-techdocs-core#changelog",children:"changelog"}),". In\ncase you want to pin the version, use the example below:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Dockerfile",children:"RUN pip3 install mkdocs-techdocs-core==1.2.3\n"})}),"\n",(0,o.jsx)(n.p,{children:"Note: We recommend Python version 3.11 or higher."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Caveat: Please install the ",(0,o.jsx)(n.code,{children:"mkdocs-techdocs-core"})," package after all other\nPython packages. The order is important to make sure we get correct version of\nsome of the dependencies."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"additional-reading",children:"Additional reading"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/features/techdocs/creating-and-publishing",children:"Creating and publishing your docs"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/features/techdocs/",children:"Back to README"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},675251:(e,n,t)=>{var o=t(667294),s=Symbol.for("react.element"),c=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,t){var o,c={},d=null,l=null;for(o in void 0!==t&&(d=""+t),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(l=n.ref),n)a.call(n,o)&&!i.hasOwnProperty(o)&&(c[o]=n[o]);if(e&&e.defaultProps)for(o in n=e.defaultProps)void 0===c[o]&&(c[o]=n[o]);return{$$typeof:s,type:e,key:d,ref:l,props:c,_owner:r.current}}n.Fragment=c,n.jsx=d,n.jsxs=d},785893:(e,n,t)=>{e.exports=t(675251)},155385:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/report-issue-addon-8aa52607fc0b839c9e4188d18d70e31a.png"},124973:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/report-issue-template-ec7a2c568334e94d2f8ce6d0a8c9d5d9.png"},511151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>a});var o=t(667294);const s={},c=o.createContext(s);function a(e){const n=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);